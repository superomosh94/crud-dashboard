<div class="table-header">
    <div class="table-title">
        <h2>Orders</h2>
        <p>Monitor transactions and fulfillment status.</p>
    </div>
    <div class="table-actions">
        <a href="/orders/export/csv" class="btn btn-secondary">
            <i class="fas fa-download"></i> Export CSV
        </a>
        <a href="/orders/create" class="btn btn-primary">
            <i class="fas fa-plus"></i> New Order
        </a>
    </div>
</div>

<!-- Stats Bar -->
<div class="dashboard-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: var(--space-lg);">
    <div class="stat-card" style="padding: var(--space-md);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <p style="color: var(--gray); font-size: 0.9rem;">Total Revenue</p>
            <i class="fas fa-dollar-sign" style="color: var(--success);"></i>
        </div>
        <h3 style="margin-top: 5px;">$<%= totalRevenue.toLocaleString() %>
        </h3>
    </div>
    <div class="stat-card" style="padding: var(--space-md);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <p style="color: var(--gray); font-size: 0.9rem;">Total Orders</p>
            <i class="fas fa-shopping-bag" style="color: var(--primary);"></i>
        </div>
        <h3 style="margin-top: 5px;">
            <%= totalOrders %>
        </h3>
    </div>
    <div class="stat-card" style="padding: var(--space-md);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <p style="color: var(--gray); font-size: 0.9rem;">Pending Actions</p>
            <i class="fas fa-clock" style="color: var(--warning);"></i>
        </div>
        <h3 style="margin-top: 5px;">
            <%= pendingOrders %>
        </h3>
    </div>
</div>

<div class="data-table-container">
    <form action="/orders" method="GET" class="table-filters">
        <div class="table-search">
            <i class="fas fa-search"></i>
            <input type="text" name="search" value="<%= search %>" placeholder="Search orders...">
        </div>
        <select name="status">
            <option value="">All Statuses</option>
            <% statusOptions.forEach(opt=> { %>
                <option value="<%= opt %>" <%=status==opt ? 'selected' : '' %>><%= opt.toUpperCase() %>
                </option>
                <% }) %>
        </select>
        <select name="payment_status">
            <option value="">All Payment</option>
            <% paymentStatusOptions.forEach(opt=> { %>
                <option value="<%= opt %>" <%=payment_status==opt ? 'selected' : '' %>><%= opt.toUpperCase() %>
                </option>
                <% }) %>
        </select>
        <button type="submit" class="btn btn-secondary btn-sm">Filter</button>
        <a href="/orders" class="btn btn-secondary btn-sm">Reset</a>
    </form>

    <table class="data-table">
        <thead>
            <tr>
                <th>Order Number</th>
                <th>Customer</th>
                <th>Total</th>
                <th>Status</th>
                <th>Payment</th>
                <th>Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% orders.forEach(order=> { %>
                <tr>
                    <td><code style="font-weight: 600;"><%= order.order_number %></code></td>
                    <td>
                        <div style="font-weight: 500;">
                            <%= order.customer ? order.customer.full_name : 'Guest' %>
                        </div>
                        <div style="font-size: 0.8rem; color: var(--gray);">
                            <%= order.customer ? order.customer.email : '' %>
                        </div>
                    </td>
                    <td style="font-weight: 600;">$<%= order.grand_total %>
                    </td>
                    <td>
                        <span class="badge badge-<%= 
                            order.status === 'completed' ? 'success' : 
                            order.status === 'pending' ? 'warning' : 
                            order.status === 'cancelled' ? 'danger' : 'info' 
                        %>">
                            <%= order.status %>
                        </span>
                    </td>
                    <td>
                        <span
                            style="font-size: 0.85rem; color: <%= order.payment_status === 'paid' ? 'var(--success)' : 'var(--gray)' %>;">
                            <i
                                class="fas fa-<%= order.payment_status === 'paid' ? 'check-circle' : 'circle-notch fa-spin' %>"></i>
                            <%= order.payment_status.toUpperCase() %>
                        </span>
                    </td>
                    <td>
                        <%= moment(order.created_at).format('MMM DD, YYYY') %>
                    </td>
                    <td class="table-actions-cell">
                        <a href="/orders/<%= order.id %>" class="btn-icon view" title="View Details"><i
                                class="fas fa-eye"></i></a>
                        <a href="/orders/<%= order.id %>/invoice" target="_blank" class="btn-icon info"
                            title="Print Invoice"><i class="fas fa-file-invoice-dollar"></i></a>
                        <% if (order.status !=='cancelled' && order.status !=='completed' ) { %>
                            <form action="/orders/<%= order.id %>/cancel" method="POST" style="display: inline;"
                                onsubmit="return confirm('Cancel this order and return items to stock?')">
                                <button type="submit" class="btn-icon delete" title="Cancel Order"><i
                                        class="fas fa-times"></i></button>
                            </form>
                            <% } %>
                    </td>
                </tr>
                <% }) %>
        </tbody>
    </table>

    <% if (totalPages> 1) { %>
        <div class="pagination">
            <% for(let i=1; i <=totalPages; i++) { %>
                <a href="/orders?page=<%= i %>" class="<%= currentPage === i ? 'active' : '' %>">
                    <%= i %>
                </a>
                <% } %>
        </div>
        <% } %>
</div>